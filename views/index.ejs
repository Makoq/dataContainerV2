<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Data services | distributed geographic modeling platform</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />
    <% include include_css.ejs %>
        <link href="/css/custom-style.css" rel="stylesheet" type="text/css" /> 
        <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">

    <div class="page-wrapper">
        <%include header.ejs%>
            <div class="clearfix"> </div>
            <div class="page-container">
                <% include sidebar.ejs %>
                    <div class="page-content-wrapper">
                        <!-- BEGIN CONTENT BODY -->
                        <div class="page-content">
                            <!-- BEGIN PAGE HEADER-->
                            <!-- BEGIN THEME PANEL -->
                            <% include theme_setting.ejs %>
                                <!-- END THEME PANEL -->
                                <!-- BEGIN PAGE BAR -->
                                <!--<div class="page-bar">
                                    <ul class="page-breadcrumb">
                                        <li>
                                            <a href="index.html">Home</a>
                                            <i class="fa fa-circle"></i>
                                        </li>
                                        <li>
                                            <span>Dashboard</span>
                                        </li>
                                    </ul>
                                </div>-->
                                <!-- END PAGE BAR -->
                                <!-- BEGIN PAGE TITLE-->

                                <!-- BEGIN PAGE TITLE-->
                                <!-- <h1 class="">Data Service Container &nbsp <small>Distributed geographic modeling platform</small></h1> -->
                                <!-- END PAGE TITLE-->
                                <!-- END PAGE TITLE-->
                                <!-- END PAGE HEADER-->



                                <div class="container-fluid" style="padding:0px;">
                                    <!-- <div id="myCarousel" class="carousel slide">
                                        <ol class="carousel-indicators">
                                            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                                            <li data-target="#myCarousel" data-slide-to="1"></li>
                                            <li data-target="#myCarousel" data-slide-to="2"></li>
                                        </ol>
                                        <div class="carousel-inner">
                                            <div class="item active" style="background:#223240">
                                                <img src="images/slide1.png" alt="第一张">
                                            </div>
                                            <div class="item" style="background:#F5E4DC;">
                                                <img src="images/slide2.png" alt="第二张">
                                            </div>
                                            <div class="item" style="background:#DE2A2D;">
                                                <img src="images/slide3.png" alt="第三张">
                                            </div>
                                        </div>
                                        <a href="#myCarousel" data-slide="prev" class="carousel-control left">
				<span class="glyphicon glyphicon-chevron-left"></span></a>
                                        <a href="#myCarousel" data-slide="next" class="carousel-control right">
				<span class="glyphicon glyphicon-chevron-right"></span></a>
                                    </div> -->

                                    <!--轮播结束-->

                                    <h3>Welcome to Data Service Container</h3>

                                    <div class="panel-group" id="accordion" style="margin-top:0px;">
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#">Four Services</a></h4>
                                            </div>
                                            <div id="collapse0" class="panel-collapse collapse in" style="cursor:pointer">

                                                <div class="tab1" style="background: #EFF0F4;position: relative;margin:0px;padding:0px">
                                                    <div class="container-fluid">
                                                        <div class="row">
                                                            <div class="col-md-6 col">
                                                                <div class="media">
                                                                    <div class="media-left">
                                                                        <a href="#"><img src="images/tab1-3.png" class="media-object" alt=""></a>
                                                                    </div>
                                                                    <div class="media-body">
                                                                        <h4 class="media-heading"><a href="/data">Data service</a></h4>
                                                                        <p>Provide data download service.</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 col">
                                                                <div class="media">
                                                                    <div class="media-left">
                                                                        <a href="#"><img src="images/tab1-1.png" class="media-object" alt=""></a>
                                                                    </div>
                                                                    <div class="media-body">
                                                                        <h4 class="media-heading"><a href="/datamap">Data processing service</a></h4>
                                                                        <!--<p class="text-muted">其他：高校不知名的讲师编写，没有任何实战价值的教材！</p>-->
                                                                        <p>Provide src data to udx data or inverse.</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 col">
                                                                <div class="media">
                                                                    <div class="media-left">
                                                                        <a href="#"><img src="images/tab1-2.png" class="media-object" alt=""></a>
                                                                    </div>
                                                                    <div class="media-body">
                                                                        <h4 class="media-heading"><a href="/refactor">Data processing solution</a></h4>
                                                                        <!--<p class="text-muted">其他：非欧美正牌大学毕业的、业界没有知名度的讲师！</p>-->
                                                                        <p>Provide exchange node information between udx data.</p>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6 col">
                                                                <div class="media">
                                                                    <div class="media-left">
                                                                        <a href="#"><img src="images/tab1-4.png" class="media-object" alt=""></a>
                                                                    </div>
                                                                    <div class="media-body">
                                                                        <h4 class="media-heading"><a href="">Visualization solution</a></h4>
                                                                        <!--<p class="text-muted">其他：社会招聘的、服务水平参差不齐的普通员工！</p>-->
                                                                        <p>Provide various visualization componet.</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <!-- end collapse0 -->
                                        </div>
                                    </div>

                                    <div class="panel-group" id="accordion" style="margin-top:10px;">
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#">Container Status Information</a></h4>
                                            </div>
                                            <div id="collapse1" class="panel-collapse collapse in" style="cursor:pointer">

                                                <div id="chartContainer" style="min-height: 600px;background: #EFF0F4;position: relative;">
                                                    <br>
                                                    <p id="data" style="margin-left: 40px;font-family: 'Microsoft YaHei';font-size: 16px;white-space: pre-wrap"></p> <br>
                                                    <div id="chart_line1" style="margin-top: 40px;width: 700px; height: 400px; float: left"></div>
                                                    <div id="chart_line2" style="width: 400px; height: 400px; margin-top: 40px; position: absolute;left: 700px;"></div>
                                                    <!--<div id="chart_line3" style="min-width: 700px; height: 250px; max-width: 800px; margin: 0 auto; float: left"></div>-->
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <!--当前局域网内主机  -->
                                    <div class="panel-group" id="accordion" style="margin-top:10px;">
                                        <div class="panel panel-success">
                                            <div class="panel-heading">
                                                <h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#">Local Area Networks</a></h4>
                                            </div>
                                            <div id="collapse2" class="panel-collapse collapse in" style="cursor:pointer">

                                            </div>
                                        </div>
                                    </div>

                                    <!-- <div class="tab2">
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6 tab2-img">
                                                    <img src="/images/tab2.jpg" class="auto img-responsive center-block" alt="">
                                                </div>
                                                <div class="text col-md-6 col-sm-6 tab2-text">
                                                    <h3>专业的数据服务团队</h3>
                                                    <p>经过地理模型专家的层层把关，让您安全方便地完成数据转换工作。</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->


                                    <!-- <div class="tab3">
                                        <div class="container-fluid">
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6">
                                                    <img src="/images/tab3.jpg" class="auto img-responsive center-block" alt="">
                                                </div>
                                                <div class="text col-md-6 col-sm-6">
                                                    <h3>安全的云数据存储</h3>
                                                    <p>最前沿的数据集成方案，让您对数据所见即所得。</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->

                                    <!-- 数据容器所在计算机的配置信息  -->
                                     <!--分页  -->
                                    <div class="pull-right" style='margin-bottom:5px;'>
                                        <a class='btn btn-primary' href="/">config</a>
                                    </div>
                                    <div class='clear'></div>
                                    <div class="table-responsive">
                                        <table id="tab_services" class="table table-bordered table-hover table-striped">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <center>Number</center>
                                                    </th>
                                                    <th>
                                                        <center>Host Name</center>
                                                    </th>
                                                    <th>
                                                        <center>Host IP</center>
                                                    </th>
                                                    <th>
                                                        <center>Port</center>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="tBody">

                                            </tbody>
                                        </table>
                                    </div>

                                </div>
                        </div>
                    </div>
            </div>
            <%include footer.ejs%>
    </div>

    <script type="text/template" id="moban">
        <tr>
            <td style="text-align:center;vertical-align:inherit;">
                <div><span>{{= id }}</span></div>
            </td>
            <td style="text-align:center;vertical-align:inherit;">
                <div><span>{{= hostname }}</span></div>
            </td>
            <td style="text-align:center;vertical-align:inherit;">
                <div><span>{{= hostip }}</span></div>
            </td>
            <td style="text-align:center;vertical-align:inherit;">
                <div><span>{{= hostport }}</span></div>
            </td>
        </tr>
    </script>


    <% include include_js.ejs %>
        <script src="/myjs/ui_handle.js" type="text/javascript"></script>

        <script type="text/javascript" src="/plugins/chart-js/highcharts.js"></script>
        <script type="text/javascript" src="/plugins/chart-js/highcharts-more.js"></script>
        <script type="text/javascript" src="/plugins/chart-js/solid-gauge.js"></script>
        <script type="text/javascript" src="/plugins/chart-js/exporting.js"></script>
        <script src="/js/underscore-noflect.js"></script>
        

        <script>
            $(function () {
                // Override global options

                // http://www.bootcdn.cn/toastr.js/readme/ for help
                // toastr.success('We do have the Kapua suite available.', 'Turtle Bay Resort', { timeOut: 5000 });
                add_notifications("notifications_list", "#", 1, "This is a test1.", "2017-5-18 20:20:00");
                add_notifications("notifications_list", "#", 1, "This is a test2.", "2017-5-18 20:20:00");
                add_notifications("notifications_list", "#", 1, "This is a test3.", "2017-5-18 20:20:00");

                // $.get('/sys/info', {}, function (data) {

                // });


                // 获取db中局域网内主机ip
                getRemoteHost();

            });

            // 获取组网内主机信息
            function getRemoteHost() {
                $.get('/rmt/ips', {pageamount:10,page:0}, function (data) {
                    if (data === '-1') {
                        toastr.error('failed to get remote host information.', 'Error', { timeOut: 3000 });
                        return;
                    }

                    var compiled = _.template($("#moban").html());
                    $("#tBody").html('');

                    for(var i = 0 ; i < data.length; i++){
						var html = compiled({
							id: i + 1,
							hostname: data[i].name,
							hostip: data[i].host,
							hostport: data[i].port
						});
						$("#tBody").append($(html));
                    }
                });
            }


            function getData(series, flag, that) {
                var xmlhttp;
                xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        // var jsonResult = eval('(' + xmlhttp.responseText + ')');
                        var jsonResult = JSON.parse(xmlhttp.responseText);
                        var stringInfo = "Host Name：" +
                            jsonResult.hostname + "       OS：" + jsonResult.systemtype + "      Version：" + jsonResult.release;
                        $("#data").html(stringInfo);
                        if (flag == 1) {
                            var usedSpace = parseFloat(jsonResult.totalmem) - parseFloat(jsonResult.freemem);
                            var percent = usedSpace / parseFloat(jsonResult.totalmem) * 100;
                            var x = (new Date()).getTime(), // 当前时间
                                y = Math.round(percent);
                            series.addPoint([x, y], true, true);
                        }
                        else if (flag == 2) {
                            var diskName = jsonResult.disk[1];
                            series.setData([['Usage', jsonResult.disk[0]], ['Free', 100 - jsonResult.disk[0]]], true, true);

                            // 设置背景色，我靠，费老鼻子劲了。 
                            $($($(that.container).children('svg')[0]).children('rect')[0]).attr('fill', '#EFF0F4');

                            that.setTitle({ text: diskName + ' Disk Usage' }, null, true);
                        }
                        else if (flag == 3) {
                            var cpus = jsonResult.cpus;
                            var i,
                                sum = 0,
                                idleSum = 0;
                            for (i = 0; i < cpus.length; i++) {
                                sum = sum + cpus[i].times.user + cpus[i].times.sys + cpus[i].times.nice + cpus[i].times.idle + cpus[i].times.irq;
                                idleSum = idleSum + cpus[i].times.idle;
                            }
                            var x = (new Date()).getTime(), // 当前时间
                                y = 100 - Math.round(idleSum / sum * 100);
                            // console.log(y);
                            series.addPoint([x, y], true, true);
                        }
                    }
                };
                if (flag == 1 || flag == 3) {
                    setInterval(function () {
                        xmlhttp.open("GET", "/sys/info", true);
                        xmlhttp.send();
                    }, 3000);
                }
                else if (flag == 2) {
                    xmlhttp.open("GET", "/sys/info", true);
                    xmlhttp.send();
                }
            }

            var chart1;
            $(function drawDynamicLine() {
                chart1 = new Highcharts.Chart({
                    chart: {
                        renderTo: 'chart_line1', //图表放置的容器，DIV
                        backgroundColor: '#EFF0F4',
                        defaultSeriesType: 'areaspline', //图表类型为曲线图
                        events: {
                            load: function () {
                                getData(this.series[0], 1);
                                getData(this.series[1], 3);
                            }
                        }
                    },
                    title: {
                        text: 'Memory/CPU Usage'  //图表标题
                    },
                    xAxis: { //设置X轴
                        title: { text: 'Time' },
                        type: 'datetime',  //X轴为日期时间类型
                        tickPixelInterval: 100  //X轴标签间隔
                    },
                    yAxis: { //设置Y轴
                        title: { text: '%' },
                        tickPixelInterval: 50,
                        max: 100, //Y轴最大值
                        min: 0  //Y轴最小值
                    },
                    tooltip: {//当鼠标悬置数据点时的提示框
                        xDateFormat: '%H:%M:%S',
                        valueSuffix: '%'
                    },
                    exporting: {
                        // buttons:{contextButton:{symbolFile:'#EFF0F4',enabled:true}},
                        enabled: false  //设置导出按钮不可用
                    },
                    credits: {
                        enabled: false
                    },
                    plotOptions: {
                        areaspline: {
                            fillOpacity: 0.3,
                            cursor: 'pointer',
                            pointStart: 1940,
                            //                        color: '#923590',
                            marker: {
                                enabled: false,
                                symbol: 'circle',   //点形状
                                radius: 2,  //点半径
                                states: {
                                    hover: {
                                        enabled: true
                                    }
                                }
                            }
                        }
                    },
                    series: [{
                        name: 'Memory Usage',
                        data: (function () { //设置默认数据，
                            var data = [],
                                time = (new Date()).getTime(),
                                i;

                            for (i = -180; i <= 0; i++) {
                                data.push({
                                    x: time + i * 1000,
                                    y: -5
                                });
                            }
                            return data;
                        })()
                    }, {
                        name: 'CPU Usage',
                        data: (function () { //设置默认数据，
                            var data = [],
                                time = (new Date()).getTime(),
                                i;

                            for (i = -180; i <= 0; i++) {
                                data.push({
                                    x: time + i * 1000,
                                    y: -5
                                });
                            }
                            return data;
                        })()
                    }]
                });
                Highcharts.setOptions({
                    global: {
                        useUTC: false
                    }
                });
            });

            $(function drawPie() {
                new Highcharts.chart({
                    chart: {
                        renderTo: 'chart_line2',
                        plotBackgroundColor: "#EFF0F4",
                        plotShadow: false,
                        events: {
                            load: function () {
                                getData(this.series[0], 2, this);
                            }
                        }
                    },
                    title: {
                        text: 'Disk Usage'
                    },
                    tooltip: { //鼠标停留悬浮标签
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    credits: {
                        enabled: false
                    },
                    legend: {
                        enabled: true,
                        backgroundColor: "#fff"
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: { //旁边的提示
                                enabled: true,
                                color: '#000000',
                                connectorColor: '#000000',
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                            }
                        }
                    },
                    exporting: {
                        // buttons:{contextButton:{symbolFile:'#EFF0F4',enabled:true}},
                        enabled: false  //设置导出按钮不可用
                    },
                    series: [{
                        type: 'pie',
                        name: 'percentage',
                        data: [
                            ['free', 0],
                            ['Usage', 0]
                        ]
                    }]
                });
            });
        </script>
</body>

</html>